---
title: "DataFest 2017"
author: "Karen Diaz, Diana Fierros-Piña, Marisa Youngblood, Tara Marin, and Marta García"
date: "3/31/2017"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(lubridate)
library(ggplot2)
library(maps)

datafest <- clicks
```

```{r}

datafest1 <- datafest %>%
  mutate(srch_checkin = ymd(srch_ci)) %>%
  inner_join(destinations, by = "srch_destination_id") %>%
  select(user_location_country, 
         user_location_region,
         srch_destination_latitude,
         srch_destination_longitude,
         orig_destination_distance,
         srch_destination_id,
         srch_destination_name,
         srch_checkin, 
         is_booking) %>%
  filter(is_booking == '1', user_location_country == 'UNITED STATES OF AMERICA')

top_five_dest <- datafest1 %>%
  group_by(user_location_region) %>%
  count(srch_destination_name, sort = TRUE) %>%
  group_by(user_location_region) %>%
  slice(1:5) %>%
  arrange(desc(n))

  

new_table <- destinations %>%
  select(srch_destination_name,
         srch_destination_latitude,
         srch_destination_longitude) 

beta_together <- top_five_dest %>%
  left_join(new_table, top_five_dest, by = "srch_destination_name") %>%
  filter(user_location_region == "FL")

```
###Map
```{r}
states <- map_data("state")

usa <-map_data("usa")

ca_df <- subset(states, region == "california")

ca_base <- ggplot(data = states) +
  geom_polygon(aes(x=long, y = lat, group = group), color = 'white', fill = "lightgray") + 
  coord_fixed(1.3) + 
  guides(fill=FALSE) +
  geom_polygon(data = ca_df, mapping = aes(x = long, y = lat, group = group), fill = "#00cc66") + 
  geom_count(data = beta_together, aes(srch_destination_longitude, srch_destination_latitude, color = "red", size = n))

ca_base
```

###Texas
```{r}
texas_together <- top_five_dest %>%
  left_join(new_table, top_five_dest, by = "srch_destination_name") %>%
  filter(user_location_region == "TX")

tx_df <- subset(states, region == "texas")

tx_base <- ggplot(data = states) +
  geom_polygon(aes(x = long, y = lat, group = group), color = 'white', fill = "lightgray") + 
  coord_fixed(1.3) + 
  guides(fill=FALSE) +
  geom_polygon(data = tx_df, mapping = aes(x = long, y = lat, group = group), fill = "#ffb366") + 
  geom_count(data = texas_together, aes(srch_destination_longitude, srch_destination_latitude, color = "red", size = n))

tx_base
```

